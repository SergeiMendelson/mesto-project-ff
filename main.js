(()=>{"use strict";var t="https://mesto.nomoreparties.co/v1/wff-cohort-1",e="8698a526-3f23-447a-a28f-f0078326bfcb",n=function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))},o=function(o){return fetch("".concat(t,"/cards/likes/").concat(o),{method:"PUT",headers:{authorization:e}}).then(n).catch((function(t){throw console.error(t),t}))},r=function(o){return fetch("".concat(t,"/cards/likes/").concat(o),{method:"DELETE",headers:{authorization:e}}).then(n).catch((function(t){throw console.error(t),t}))},c=function(o){return fetch("".concat(t,"/cards/").concat(o),{method:"DELETE",headers:{authorization:e}}).then(n).catch((function(t){throw console.error(t),t}))};function a(t,e,n,a){var i=document.querySelector("#card-template").content.cloneNode(!0).querySelector(".card"),u=i.querySelector(".card__image"),l=i.querySelector(".card__likes-counter"),s=i.querySelector(".card__like-button"),p=i.querySelector(".card__delete-button");return u.src=t.link,u.alt=t.name,i.querySelector(".card__title").textContent=t.name,l.textContent=t.likes.length,t.owner._id!==a&&(p.style.display="none"),s.addEventListener("click",(function(){var e=s.classList.contains("card__like-button_is-active");(e?r:o)(t._id).then((function(t){s.classList.toggle("card__like-button_is-active",!e),l.textContent=t.likes.length})).catch((function(t){return console.error("Ошибка при обработке лайка:",t)}))})),p.addEventListener("click",(function(){window.confirm("Вы уверены, что хотите удалить эту карточку?")&&c(t._id).then((function(){i.remove()})).catch((function(t){return console.error("Ошибка при удалении карточки:",t)}))})),u.addEventListener("click",(function(){e(n),n.querySelector(".popup__image").src=t.link,n.querySelector(".popup__caption").textContent=t.name})),i}function i(t){t.style.display="flex",t.classList.add("popup_is-opened"),t.classList.remove("popup_is-animated"),document.addEventListener("keydown",l)}function u(t){t.classList.remove("popup_is-opened"),t.classList.add("popup_is-animated"),document.removeEventListener("keydown",l)}function l(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&u(e)}}function s(t,e){!function(t){var e,n;t.validity.valueMissing?t.setCustomValidity("Вы пропустили это поле"):("name"!==t.name&&"place-name"!==t.name||(n=t.value,/^[A-Za-zА-Яа-яЁё\s-]*$/.test(n)))&&("description"!==t.name&&"place-name"!==t.name||(e=t.value,/^[A-Za-zА-Яа-яЁё\s-]*$/.test(e)))?"place-name"===t.name&&t.validity.tooShort?t.setCustomValidity("Минимальная длина - 2 символа"):"link"===t.name&&t.validity.patternMismatch?t.setCustomValidity("Введите правильный URL"):t.setCustomValidity(""):t.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы")}(t),t.validity.valid?p(t,e):function(t,e,n){var o=t.nextElementSibling;t.classList.add(n.inputErrorClass),o.textContent=e,o.classList.add(n.errorClass)}(t,t.validationMessage,e)}function p(t,e){var n=t.nextElementSibling;t.classList.remove(e.inputErrorClass),n.classList.remove(e.errorClass),n.textContent=""}function d(t,e,n){var o=t.every((function(t){return t.validity.valid}));e.disabled=!o,e.classList.toggle(n.inactiveButtonClass,!o)}function f(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));n.forEach((function(t){p(t,e)})),d(n,t.querySelector(e.submitButtonSelector),e)}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var y,_=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),v=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__image"),q=document.querySelectorAll(".popup"),C=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_update-avatar"),g=document.querySelector(".popup_type_image"),k=document.querySelector('.popup__form[name="edit-profile"]'),x=document.querySelector('.popup__form[name="new-place"]'),w=document.querySelector('.popup__form[name="update-avatar"]'),A=k.querySelector(".popup__input_type_name"),j=k.querySelector(".popup__input_type_description"),z=document.querySelector(".popup__input_type_avatar-url"),T=document.querySelector(".places__list"),O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};y=O,document.querySelectorAll(y.formSelector).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()}));var e=Array.from(t.querySelectorAll(y.inputSelector));e.forEach((function(n){n.addEventListener("input",(function(){s(n,y),d(e,t.querySelector(y.submitButtonSelector),y)})),n.addEventListener("focus",(function(){p(n,y)})),n.addEventListener("blur",(function(){s(n,y)}))})),d(e,t.querySelector(y.submitButtonSelector),y)})),k.addEventListener("submit",(function(o){var r,c,a;o.preventDefault(),(a=k.querySelector(".popup__button")).textContent="Сохранение...",a.disabled=!0,(r=A.value,c=j.value,fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:r,about:c})}).then(n).catch((function(t){throw console.error(t),t}))).then((function(t){_.textContent=t.name,h.textContent=t.about,u(C)})).catch((function(t){return console.error(t)})).finally((function(){a.textContent="Сохранить",a.disabled=!1}))})),x.addEventListener("submit",(function(o){o.preventDefault(),function(){var o=x.querySelector(".popup__button");o.textContent="Сохранение...",o.disabled=!0;var r,c,l=x.querySelector(".popup__input_type_card-name"),s=x.querySelector(".popup__input_type_url");(r=l.value,c=s.value,fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:r,link:c})}).then(n).catch((function(t){throw console.error(t),t}))).then((function(t){var e=a(t,i,g);T.prepend(e),u(E),x.reset()})).catch((function(t){return console.error(t)})).finally((function(){o.textContent="Сохранить",o.disabled=!1}))}()})),b.addEventListener("click",(function(){i(L),f(L.querySelector(".popup__form"),O)})),w.addEventListener("submit",(function(o){var r,c;o.preventDefault(),(c=w.querySelector(".popup__button")).textContent="Сохранение...",c.disabled=!0,(r=z.value,fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})}).then(n).catch((function(t){throw console.error(t),t}))).then((function(t){console.log("Аватар успешно обновлен:",t),b.style.backgroundImage="url('".concat(t.avatar,"')"),u(L)})).catch((function(t){console.error("Ошибка при обновлении аватара:",t)})).finally((function(){c.textContent="Сохранить",c.disabled=!1}))})),v.addEventListener("click",(function(){A.value=_.textContent,j.value=h.textContent,i(C),f(k,O)})),S.addEventListener("click",(function(){i(E),f(x,O)})),q.forEach((function(t){!function(t){t.querySelector(".popup__close").addEventListener("click",(function(){return u(t)})),t.addEventListener("click",(function(e){e.target.classList.contains("popup")&&u(t)}))}(t)})),Promise.all([fetch("".concat(t,"/users/me"),{headers:{authorization:e}}).then(n).catch((function(t){throw console.error(t),t})),fetch("".concat(t,"/cards"),{headers:{authorization:e}}).then(n).catch((function(t){throw console.error(t),t}))]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];_.textContent=r.name,h.textContent=r.about,b.style.backgroundImage="url('".concat(r.avatar,"')"),c.forEach((function(t){var e=a(t,i,g,r._id);T.appendChild(e)}))})).catch((function(t){return console.error(t)}))})();