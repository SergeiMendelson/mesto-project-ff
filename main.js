(()=>{"use strict";function e(e,t,n,o,r){var a=document.querySelector("#card-template").content.cloneNode(!0).querySelector(".card"),c=a.querySelector(".card__image"),i=a.querySelector(".card__likes-counter"),u=a.querySelector(".card__like-button"),l=a.querySelector(".card__delete-button");return c.src=e.link,c.alt=e.name,a.querySelector(".card__title").textContent=e.name,i.textContent=e.likes.length,e.owner._id!==r?l.style.display="none":l.style.display="block",e.likes.some((function(e){return e._id===r}))&&u.classList.add("card__like-button_is-active"),u.addEventListener("click",(function(){return o(e._id,u,i)})),l.addEventListener("click",(function(){return n(e._id,a)})),c.addEventListener("click",(function(){return t(e.link,e.name)})),a}function t(e){e.style.display="flex",e.classList.add("popup_is-opened"),e.classList.remove("popup_is-animated"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),document.removeEventListener("keydown",o)}function o(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}}function r(e,t){!function(e){var t,n;e.validity.valueMissing?e.setCustomValidity("Вы пропустили это поле"):("name"!==e.name&&"place-name"!==e.name||(n=e.value,/^[A-Za-zА-Яа-яЁё\s-]*$/.test(n)))&&("description"!==e.name&&"place-name"!==e.name||(t=e.value,/^[A-Za-zА-Яа-яЁё\s-]*$/.test(t)))?"place-name"===e.name&&e.validity.tooShort?e.setCustomValidity("Минимальная длина - 2 символа"):"link"===e.name&&e.validity.patternMismatch?e.setCustomValidity("Введите правильный URL"):e.setCustomValidity(""):e.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы")}(e),e.validity.valid?a(e,t):function(e,t,n){var o=e.nextElementSibling;e.classList.add(n.inputErrorClass),o.textContent=t,o.classList.add(n.errorClass)}(e,e.validationMessage,t)}function a(e,t){var n=e.nextElementSibling;e.classList.remove(t.inputErrorClass),n.classList.remove(t.errorClass),n.textContent=""}function c(e,t,n){var o=e.every((function(e){return e.validity.valid}));t.disabled=!o,t.classList.toggle(n.inactiveButtonClass,!o)}function i(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(e){a(e,t)})),c(n,e.querySelector(t.submitButtonSelector),t)}var u="https://mesto.nomoreparties.co/v1/wff-cohort-1",l="8698a526-3f23-447a-a28f-f0078326bfcb",s=function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))},p=function(){return fetch("".concat(u,"/users/me"),{headers:{authorization:l}}).then(s)},d=function(e){return fetch("".concat(u,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:l}}).then(s)},f=function(e){return fetch("".concat(u,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:l}}).then(s)},m=function(e){return fetch("".concat(u,"/cards/").concat(e),{method:"DELETE",headers:{authorization:l}}).then(s)};function _(e,n){var o=document.querySelector(".popup_type_image"),r=o.querySelector(".popup__image"),a=o.querySelector(".popup__caption");r.src=e,r.alt=n,a.textContent=n,t(o)}function y(e,t){window.confirm("Вы уверены, что хотите удалить эту карточку?")&&m(e).then((function(){t.remove()})).catch((function(e){return console.error("Ошибка при удалении карточки:",e)}))}function v(e,t,n){var o=t.classList.contains("card__like-button_is-active");(o?f:d)(e).then((function(e){t.classList.toggle("card__like-button_is-active",!o),n.textContent=e.likes.length})).catch((function(e){return console.error("Ошибка при обработке лайка:",e)}))}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var S,b=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),C=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__image"),g=document.querySelectorAll(".popup"),k=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card"),A=document.querySelector(".popup_type_update-avatar"),w=(document.querySelector(".popup_type_image"),document.querySelector('.popup__form[name="edit-profile"]')),j=document.querySelector('.popup__form[name="new-place"]'),z=document.querySelector('.popup__form[name="update-avatar"]'),T=w.querySelector(".popup__input_type_name"),O=w.querySelector(".popup__input_type_description"),B=document.querySelector(".popup__input_type_avatar-url"),D=document.querySelector(".places__list"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};S=P,document.querySelectorAll(S.formSelector).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()}));var t=Array.from(e.querySelectorAll(S.inputSelector));t.forEach((function(n){n.addEventListener("input",(function(){r(n,S),c(t,e.querySelector(S.submitButtonSelector),S)})),n.addEventListener("focus",(function(){a(n,S)})),n.addEventListener("blur",(function(){r(n,S)}))})),c(t,e.querySelector(S.submitButtonSelector),S)})),w.addEventListener("submit",(function(e){var t,o,r;e.preventDefault(),(r=w.querySelector(".popup__button")).textContent="Сохранение...",r.disabled=!0,(t=T.value,o=O.value,fetch("".concat(u,"/users/me"),{method:"PATCH",headers:{authorization:l,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:o})}).then(s)).then((function(e){b.textContent=e.name,q.textContent=e.about,n(k)})).catch((function(e){return console.error("Ошибка при обновлении информации о пользователе:",e)})).finally((function(){r.textContent="Сохранить",r.disabled=!1}))})),j.addEventListener("submit",(function(t){t.preventDefault(),function(){var t=j.querySelector(".popup__button");t.textContent="Сохранение...",t.disabled=!0;var o=j.querySelector(".popup__input_type_card-name"),r=j.querySelector(".popup__input_type_url");p().then((function(a){var c,p;(c=o.value,p=r.value,fetch("".concat(u,"/cards"),{method:"POST",headers:{authorization:l,"Content-Type":"application/json"},body:JSON.stringify({name:c,link:p})}).then(s)).then((function(t){var o=e(t,_,y,v,a._id);D.prepend(o),n(x),j.reset(),i(j,P)})).catch((function(e){return console.error("Ошибка при добавлении новой карточки:",e)})).finally((function(){t.textContent="Сохранить",t.disabled=!1}))})).catch((function(e){return console.error("Ошибка при получении данных пользователя:",e)}))}()})),L.addEventListener("click",(function(){B.value="",t(A),i(z,P)})),z.addEventListener("submit",(function(e){var t,o;e.preventDefault(),(o=z.querySelector(".popup__button")).textContent="Сохранение...",o.disabled=!0,(t=B.value,fetch("".concat(u,"/users/me/avatar"),{method:"PATCH",headers:{authorization:l,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(s)).then((function(e){L.style.backgroundImage="url('".concat(e.avatar,"')"),n(A)})).catch((function(e){return console.error("Ошибка при обновлении аватара:",e)})).finally((function(){o.textContent="Сохранить",o.disabled=!1}))})),C.addEventListener("click",(function(){T.value=b.textContent,O.value=q.textContent,t(k),i(w,P)})),E.addEventListener("click",(function(){t(x),i(j,P)})),g.forEach((function(e){!function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return n(e)})),e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&n(e)}))}(e)})),Promise.all([p(),fetch("".concat(u,"/cards"),{headers:{authorization:l}}).then(s)]).then((function(t){var n,o,r=(o=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=a.call(n)).done)&&(i.push(o.value),i.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return i}}(n,o)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=r[0],c=r[1];b.textContent=a.name,q.textContent=a.about,L.style.backgroundImage="url('".concat(a.avatar,"')"),c.forEach((function(t){var n=e(t,_,y,v,a._id);D.appendChild(n)}))})).catch((function(e){return console.error("Ошибка при получении данных пользователя и карточек:",e)}))})();